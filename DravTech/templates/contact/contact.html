{% extends 'base.html' %}
{% load static %}
<link rel="stylesheet" href="{% static 'assets/css/contact.css' %}">

{% block content %}

<main class="main">

<section id="contact" class="contact section">

  <div class="container section-title" data-aos="fade-up">
    <h2>Contact</h2>
    <p>Start a conversation about your next project — we're ready to help.</p>
  </div>

  <div class="container" data-aos="fade-up" data-aos-delay="100">
    <div class="row gy-5 align-items-stretch">

      <!-- INFO PANEL (unchanged structurally, just compacted) -->
      <div class="col-lg-5" data-aos="fade-right" data-aos-delay="200">
        <div class="info-panel">
          <div class="panel-header">
            <span class="section-badge">
              <i class="bi bi-chat-dots-fill"></i> Get In Touch
            </span>
            <h3>Let's Bring Your Vision to Life</h3>
            <p>Tell us about your goals and constraints — we'll propose a practical plan, timeline, and next steps.</p>
          </div>

          <div class="contact-methods">

            <div class="method-item">
              <div class="method-icon"><i class="bi bi-envelope-paper-fill"></i></div>
              <div class="method-details">
                <span class="method-label">Email Us</span>
                <a href="mailto:dravislotum@gmail.com">dravislotum@gmail.com</a><br>
                <a href="mailto:samuelkibunja55@gmail.com">samuelkibunja55@gmail.com</a>
              </div>
            </div>

            <div class="method-item">
              <div class="method-icon"><i class="bi bi-headset"></i></div>
              <div class="method-details">
                <span class="method-label">Call Us</span>
                <a href="tel:+254758067458">+254 758 067 458</a><br>
                <a href="tel:+254720357085">+254 720 357 085</a>
              </div>
            </div>

            <div class="method-item">
              <div class="method-icon"><i class="bi bi-pin-map-fill"></i></div>
              <div class="method-details">
                <span class="method-label">Visit Us</span>
                <span>Nairobi, Kenya</span>
              </div>
            </div>

            <div class="method-item">
              <div class="method-icon"><i class="bi bi-clock"></i></div>
              <div class="method-details">
                <span class="method-label">Working Hours</span>
                <span>Mon - Fri: 8:00 AM - 6:00 PM</span><br>
                <span>Sat: 9:00 AM - 2:00 PM</span>
              </div>
            </div>

          </div>

          {% if contact_stats %}
          <div class="stats-strip">
            {% for stat in contact_stats %}
              <div class="stat-item">
                <span class="stat-number">{{ stat.value }}</span>
                <span class="stat-text">{{ stat.label }}</span>
              </div>
            {% endfor %}
          </div>
          {% endif %}

        </div>
      </div>

      <!-- FORM -->
      <div class="col-lg-7" data-aos="fade-left" data-aos-delay="300">
        <div class="form-card">

          <div class="form-card-header">
            <h4>Send Us a Message</h4>
            <p>Fill out the form and our team will respond within 24 hours.</p>
          </div>

          <form id="contact-form" method="post" action="{% url 'contact' %}">
            {% csrf_token %}

            <!-- Django Messages -->
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                  {{ message }}
                </div>
              {% endfor %}
            {% endif %}

            <div class="row g-4">

              <div class="col-md-6">
                <label>Your Name *</label>
                {{ form.name }}
                {{ form.name.errors }}
              </div>

              <div class="col-md-6">
                <label>Email Address *</label>
                {{ form.email }}
                {{ form.email.errors }}
              </div>

              <div class="col-md-6">
                <label>Phone Number</label>
                {{ form.phone }}
                {{ form.phone.errors }}
              </div>

              <div class="col-md-6">
                <label>Company</label>
                {{ form.company }}
                {{ form.company.errors }}
              </div>

              <div class="col-md-6">
                <label>Inquiry Type</label>
                {{ form.contact_type }}
              </div>

              <div class="col-md-6">
                <label>Priority</label>
                {{ form.priority }}
              </div>

              <div class="col-12">
                <label>Subject *</label>
                {{ form.subject }}
                {{ form.subject.errors }}
              </div>

              <div class="col-12">
                <label>Your Message *</label>
                {{ form.message }}
                {{ form.message.errors }}
              </div>

            </div>

            <div class="form-actions mt-4">
              <button type="submit" class="btn-submit">
                Send Message
              </button>
            </div>

          </form>

        </div>
      </div>

    </div>
  </div>

</section>

<!-- Confirmation Overlay -->
<div class="confirmation-overlay" id="confirmationOverlay">
  <div class="confirmation-modal">
    <div class="confirmation-header">
      <div class="success-icon-wrapper">
        <div class="success-icon">
          <i class="bi bi-check-lg"></i>
        </div>
      </div>
      <h2 class="confirmation-title">Message Sent Successfully!</h2>
      <p class="confirmation-subtitle">Thank you for reaching out to us</p>
    </div>
    
    <div class="confirmation-body">
      <div class="progress-indicator">
        <div class="progress-dot active"></div>
        <div class="progress-dot"></div>
        <div class="progress-dot"></div>
      </div>
      
      <div class="confirmation-message">
        Your message has been received and our team has been notified. We typically respond within 24 hours during business days.
      </div>
      
      <div class="confirmation-details">
        <div class="detail-item">
          <i class="bi bi-envelope-check"></i>
          <span>Confirmation email sent to your address</span>
        </div>
        <div class="detail-item">
          <i class="bi bi-people"></i>
          <span>Team notification delivered</span>
        </div>
        <div class="detail-item">
          <i class="bi bi-clock-history"></i>
          <span>Response time: Within 24 hours</span>
        </div>
      </div>
      
      <div class="confirmation-actions">
        <button class="btn-confirmation btn-primary-confirmation" onclick="closeConfirmation()">
          <i class="bi bi-house"></i>
          Back to Home
        </button>
        <button class="btn-confirmation btn-secondary-confirmation" onclick="viewContactHistory()">
          <i class="bi bi-clock-history"></i>
          View My Messages
        </button>
      </div>
    </div>
  </div>
</div>

</main>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const contactForm = document.getElementById('contact-form');
  const confirmationOverlay = document.getElementById('confirmationOverlay');
  
  if (contactForm && confirmationOverlay) {
    contactForm.addEventListener('submit', function(e) {
      // Check if form is valid and has success message
      setTimeout(() => {
        // Look for success message in Django messages
        const successMessages = document.querySelectorAll('.alert-success');
        if (successMessages.length > 0) {
          showConfirmation();
        }
      }, 100);
    });
    
    // Auto-close confirmation after 10 seconds
    let autoCloseTimer;
    function startAutoClose() {
      autoCloseTimer = setTimeout(() => {
        closeConfirmation();
      }, 10000); // 10 seconds
    }
    
    function showConfirmation() {
      confirmationOverlay.classList.add('show');
      document.body.style.overflow = 'hidden';
      startAutoClose();
      
      // Play success sound
      playSuccessSound();
    }
    
    function closeConfirmation() {
      confirmationOverlay.classList.remove('show');
      document.body.style.overflow = '';
      if (autoCloseTimer) {
        clearTimeout(autoCloseTimer);
      }
    }
    
    // Make functions globally accessible
    window.closeConfirmation = closeConfirmation;
    window.viewContactHistory = function() {
      window.location.href = '{% url "user_contact_history" %}';
    };
    
    // Close on overlay click
    confirmationOverlay.addEventListener('click', function(e) {
      if (e.target === confirmationOverlay) {
        closeConfirmation();
      }
    });
    
    // Close on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && confirmationOverlay.classList.contains('show')) {
        closeConfirmation();
      }
    });
    
    // Success sound function
    function playSuccessSound() {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Create a pleasant success chime
        const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
        notes.forEach((frequency, index) => {
          setTimeout(() => {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.05);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
          }, index * 150);
        });
      } catch (e) {
        console.log('Audio not available for success sound');
      }
    }
  }
});
</script>
{% endblock %}
