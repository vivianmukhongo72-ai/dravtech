{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Confirmed — DravTech</title>
  <meta name="description" content="Your order has been successfully placed">
  <meta name="csrf-token" content="{{ csrf_token }}">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/aos/aos.css' %}" rel="stylesheet">

  <!-- Main CSS Files -->
  <link href="{% static 'assets/css/main.css' %}" rel="stylesheet">
  
  <style>
    /* ── Order Confirmation Styling ── */
    body {
      background: #f8fafc;
      font-family: 'DM Sans', sans-serif;
      color: #1e293b;
    }

    .confirmation-page {
      min-height: 100vh;
      background: #f8fafc;
    }

    /* Steps */
    .steps-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0;
      padding: 40px 0;
      border-bottom: 1px solid #e2e8f0;
      background: white;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 0.9rem;
      font-weight: 600;
      color: #94a3b8;
    }

    .step.done {
      color: #10b981;
    }

    .step.active {
      color: #2563eb;
    }

    .step-num {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid currentColor;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      background: white;
    }

    .step.done .step-num {
      background: #10b981;
      color: white;
      border-color: #10b981;
    }

    .step.active .step-num {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }

    .step-line {
      width: 60px;
      height: 2px;
      background: #e2e8f0;
      margin: 0 8px;
    }

    /* Hero tick */
    .confirm-hero {
      text-align: center;
      padding: 80px 20px 60px;
    }

    .tick-ring {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.8rem;
      color: #065f46;
      margin: 0 auto 32px;
      box-shadow: 0 0 0 16px #d1fae540;
      animation: pop 0.6s ease;
    }

    @keyframes pop {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    .confirm-hero h1 {
      font-family: 'Sora', sans-serif;
      font-size: 2.5rem;
      font-weight: 800;
      color: #1e293b;
      margin-bottom: 16px;
      letter-spacing: -0.02em;
    }

    .confirm-hero p {
      font-size: 1.2rem;
      color: #64748b;
      margin-bottom: 40px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .order-number {
      display: inline-block;
      background: #f1f5f9;
      color: #2563eb;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 700;
      font-family: 'Sora', sans-serif;
      margin-bottom: 40px;
    }

    /* Actions */
    .confirm-actions {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn-primary {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 28px;
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      text-decoration: none;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1rem;
      font-family: 'Sora', sans-serif;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4);
      color: white;
    }

    .btn-outline {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 24px;
      background: transparent;
      color: #64748b;
      text-decoration: none;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }

    .btn-outline:hover {
      background: white;
      border-color: #2563eb;
      color: #2563eb;
    }

    /* Order details */
    .order-details {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 20px 60px;
    }

    .details-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 20px;
      padding: 32px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.06);
    }

    .details-title {
      font-family: 'Sora', sans-serif;
      font-size: 1.4rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .details-title i {
      color: #2563eb;
    }

    .details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    .detail-item {
      padding: 16px 0;
      border-bottom: 1px solid #f1f5f9;
    }

    .detail-item:last-child {
      border-bottom: none;
    }

    .detail-label {
      font-size: 0.85rem;
      color: #64748b;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .detail-value {
      font-size: 1rem;
      color: #1e293b;
      font-weight: 600;
    }

    .btn-download {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: #eff6ff;
      color: #1e40af;
      border: 1px solid #bfdbfe;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      text-decoration: none;
      margin-top: 8px;
      transition: all 0.2s ease;
    }

    .btn-download:hover {
      background: #dbeafe;
      color: #1e40af;
      transform: translateY(-1px);
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
      .confirm-hero h1 {
        font-size: 2rem;
      }
      
      .confirm-hero p {
        font-size: 1.1rem;
      }
      
      .confirm-actions {
        flex-direction: column;
        align-items: center;
      }
      
      .btn-primary,
      .btn-outline {
        width: 100%;
        max-width: 300px;
        justify-content: center;
      }
      
      .details-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .details-card {
        padding: 24px 20px;
      }
      
      .tick-ring {
        width: 80px;
        height: 80px;
        font-size: 2.2rem;
      }
    }
  </style>
</head>
<body class="starter-page-page">

<!-- Include Header -->
{% include 'marketplace/partials/header.html' %}
{% block content %}
<!-- Main Content -->
<main class="main-content">
   

      <!-- Action buttons -->
      <div style="display:flex; gap:14px; flex-wrap:wrap;">
        <a href="{% url 'marketplace:products' %}" class="btn-primary-sm">
          <i class="bi bi-grid"></i> Continue Shopping
        </a>
        {% if request.user.is_authenticated %}
        <a href="/account/orders/" class="btn-outline-sm">
          <i class="bi bi-receipt"></i> View My Orders
        </a>
        {% endif %}
      </div>

    </div><!-- /left -->

    <!-- Right: Summary -->
    <div class="sum-panel">
      <div class="sp-header">Order Summary</div>
      <div class="sp-row"><span class="lbl">Order #</span><span>{{ order.id }}</span></div>
      <div class="sp-row"><span class="lbl">Date</span><span>{{ order.created_at|date:"d M Y" }}</span></div>
      <div class="sp-row"><span class="lbl">Status</span>
        <span class="status-pill status-{{ order.status }}">{{ order.get_status_display }}</span>
      </div>
      <div class="sp-row"><span class="lbl">Subtotal</span><span>KES {{ order.subtotal|floatformat:2 }}</span></div>
      <div class="sp-row">
        <span class="lbl">Shipping</span>
        <span>{% if order.shipping_cost > 0 %}KES {{ order.shipping_cost|floatformat:2 }}{% else %}Free{% endif %}</span>
      </div>
      <div class="sp-total">
        <span>Total</span><span>KES {{ order.total|floatformat:2 }}</span>
      </div>

      {% if order.payment_status != 'paid' %}
      <div style="padding:16px 22px; background:#fef9c3; border-top:1px solid var(--border);">
        <div style="display:flex; align-items:center; gap:8px; font-size:.82rem; color:#854d0e;">
          <i class="bi bi-exclamation-triangle-fill"></i>
          <strong>Awaiting Payment</strong>
        </div>
        <p style="margin:6px 0 0; font-size:.78rem; color:#92400e;">
          Please complete your M-Pesa payment to confirm this order.
        </p>
      </div>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}

<div class="confirmation-page">

<!-- Steps -->
<div class="steps-bar">
  <div class="step done"><span class="step-num"><i class="bi bi-check2"></i></span><span class="d-none d-sm-inline">Cart</span></div>
  <div class="step-line"></div>
  <div class="step done"><span class="step-num"><i class="bi bi-check2"></i></span><span class="d-none d-sm-inline">Checkout</span></div>
  <div class="step-line"></div>
  <div class="step active"><span class="step-num"><i class="bi bi-check2"></i></span><span class="d-none d-sm-inline">Confirmation</span></div>
</div>

<!-- Hero -->
<div class="confirm-hero">
  <div class="tick-ring"><i class="bi bi-check2-all"></i></div>
  <h1>Order Confirmed!</h1>
  <p>
    Thank you for your order! We've received your order details and sent a confirmation email to you. 
    {% if order.has_physical_items %}
      We'll begin preparing your items for delivery.
    {% else %}
      Your digital items are ready for download.
    {% endif %}
  </p>
  <div class="order-number">
    <i class="bi bi-hash"></i> Order #{{ order.id }}
  </div>
  
  <div class="confirm-actions">
    <a href="{% url 'marketplace:marketplace' %}" class="btn-primary">
      <i class="bi bi-shop"></i>
      Continue Shopping
    </a>
    <a href="{% url 'marketplace:order-detail' order.id %}" class="btn-outline">
      <i class="bi bi-eye"></i>
      View Order Details
    </a>
  </div>
</div>

<!-- Order Details -->
<div class="order-details">
  <div class="details-card">
    <h3 class="details-title">
      <i class="bi bi-receipt"></i>
      Order Summary
    </h3>
    
    <div class="details-grid">
      <div class="detail-item">
        <div class="detail-label">Order Number</div>
        <div class="detail-value">#{{ order.id }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Order Date</div>
        <div class="detail-value">{{ order.created_at|date:"F j, Y" }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Order Status</div>
        <div class="detail-value">{{ order.get_status_display }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Email</div>
        <div class="detail-value">{{ order.email }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Subtotal</div>
        <div class="detail-value">KES {{ order.subtotal|floatformat:2 }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Shipping</div>
        <div class="detail-value">
          {% if order.shipping_cost %}KES {{ order.shipping_cost|floatformat:2 }}{% else %}Free{% endif %}
        </div>
      </div>
      
      <div class="detail-item" style="grid-column: 1 / -1;">
        <div class="detail-label">Total</div>
        <div class="detail-value" style="font-size: 1.2rem; color: #2563eb;">KES {{ order.total|floatformat:2 }}</div>
      </div>
    </div>
    
    {% if order.shipping_address %}
    <h3 class="details-title" style="margin-top: 32px;">
      <i class="bi bi-geo-alt"></i>
      Shipping Address
    </h3>
    
    <div class="detail-item" style="grid-column: 1 / -1;">
      <div class="detail-value">
        {{ order.shipping_address.full_name }}<br>
        {{ order.shipping_address.address_1 }}{% if order.shipping_address.address_2 %}, {{ order.shipping_address.address_2 }}{% endif %}<br>
        {{ order.shipping_address.city }}{% if order.shipping_address.county %}, {{ order.shipping_address.county }}{% endif %}<br>
        {{ order.shipping_address.country }}{% if order.shipping_address.postal_code %}, {{ order.shipping_address.postal_code }}{% endif %}<br>
        {{ order.shipping_address.phone }}<br>
        {{ order.shipping_address.email }}
      </div>
    </div>
    {% endif %}
    
    <h3 class="details-title" style="margin-top: 32px;">
      <i class="bi bi-box-seam"></i>
      Items Ordered
    </h3>
    
    {% for item in order.items.all %}
    <div class="detail-item" style="grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: center;">
      <div>
        <div class="detail-value">{{ item.product_title }}</div>
        <div class="detail-label">{{ item.get_product_type_display }} • Quantity: {{ item.quantity }}</div>
        {% if item.product_type == 'digital' %}
        <a href="{% url 'marketplace:download-item' item.id %}" class="btn-download" style="margin-top: 8px;">
          <i class="bi bi-download"></i> Download
        </a>
        {% endif %}
      </div>
      <div class="detail-value">KES {{ item.unit_price|floatformat:2 }}</div>
    </div>
    {% endfor %}
    
    <!-- Email Notification Status -->
    <div style="margin-top: 32px; padding: 20px; background: #f0fdf4; border-radius: 12px; border: 1px solid #86efac;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
        <i class="bi bi-envelope-check" style="color: #16a34a; font-size: 1.2rem;"></i>
        <h4 style="color: #16a34a; margin: 0; font-family: 'Sora', sans-serif;">Confirmation Sent</h4>
      </div>
      <p style="color: #15803d; margin: 0; font-size: 0.95rem;">
        We've sent a detailed order confirmation to <strong>{{ order.email }}</strong>. 
        Please check your inbox (and spam folder) for your order details.
      </p>
    </div>
  </div>
</div>

</div>

</main>

<!-- Include Footer -->
{% include 'marketplace/partials/footer.html' %}

</body>
</html>
